## SQL Drills

```
id  
name  
nyc_restaurant_id
borough
cuisine  
address_building_number
address_street
address_zipcode 
```

 completed a drill, paste your query into a Gist to reference later on.

*1. Get all restaurants*: Write a query that returns all of the restaurants, with all of the fields.
`SELECT * FROM restaurants;`

*2. Get Italian restaurants*: Write a query that returns all of the Italian restaurants, with all of the fields
`SELECT * FROM restaurants WHERE cuisine = 'Italian';`

*3. Get 10 Italian restaurants, subset of fields*: Write a query that gets 10 Italian restaurants, returning only the id and name fields.
`SELECT id, name FROM restaurants WHERE cuisine = 'Italian' LIMIT 10;`

*4. Count of Thai restaurants*: Write a query that returns the number of Thai restaurants.
`SELECT count(*) FROM restaurants WHERE cuisine = 'Thai';`

*5. Count of restaurants*: Write a query that returns the total number of restaurants.
`SELECT count(*) FROM restaurants;`

*6. Count of Thai restaurants in zip code*: Write a query that returns the number of Thai restaurants in the 11372 zip code.
`SELECT count(*) FROM restaurants WHERE cuisine = 'Thai' AND address_zipcode = '11372';`

*7. Italian restaurants in one of several zip codes*: Write a query that returns the id and name of five Italian restaurants in the 10012, 10013, or 10014 zip codes. The initial results (before limiting to five) should be alphabetically sorted.
`SELECT * FROM restaurants WHERE cuisine = 'Italian' 
AND address_zipcode IN ('10012', '10013', '10014');`

*8. Create a restaurant*: Create a restaurant with the following properties:
```
name: 'Byte Cafe',
borough: 'Brooklyn',
cuisine: 'coffee',
address_building_number: '123',
address_street: 'Atlantic Avenue',
address_zipcode: '11231'
```

`INSERT INTO restaurants (name,borough,cuisine,address_building_number,address_street,address_zipcode) VALUES ('Byte Cafe','Brooklyn','coffee','123','Atlantic Avenue','11231');`

`SELECT * FROM restaurants order by id desc limit 1;`

*9. Create a restaurant and return id and name*: Create a restaurant with values of your choosing, and return the id and name.

`INSERT INTO restaurants (name,borough,cuisine,address_building_number,address_street,address_zipcode) VALUES ('Byte Cafe 2','Brooklyn','coffee','123 2','Atlantic Avenue 2','11231') RETURNING id, name;`

*10. Create three restaurants and return id and name*: Create three restaurants using a single command, with values of your choosing, returning the id and name of each restaurant.

`INSERT INTO restaurants (name,borough,cuisine,address_building_number,address_street,address_zipcode) 
VALUES 
('Byte Cafe 11','Brooklyn','coffee','123 2','Atlantic Avenue 2','11231') ,
('Byte Cafe 22','Brooklyn','coffee','123 2','Atlantic Avenue 2','11231') ,
('Byte Cafe 33','Brooklyn','coffee','123 2','Atlantic Avenue 2','11231') 
RETURNING id, name;`

*11. Update a record*: Update the record whose value for nyc_restaurant_id is '30191841'. Change the name from 'Dj Reynolds Pub And Restaurant' to 'DJ Reynolds Pub and Restaurant'.


`UPDATE restaurants SET name = 'DJ Reynolds Pub and Restaurant' 
WHERE nyc_restaurant_id='30191841';`

*12. Delete by id*: Delete the grade whose id is 10.

`DELETE FROM grades WHERE id = 10;`

*13. A blocked delete*: Try deleting the restaurant with id of 22. What error do you get?

`DELETE FROM restaurants WHERE id = 22;`

Paste the error text for the answer. We'll learn about foreign key constraints in the next reading, but take two seconds and come up with your own theory about what this message means.

```
ERROR:  update or delete on table "restaurants" violates foreign key constraint "grades_restaurant_id_fkey" on table "grades"
DETAIL:  Key (id)=(22) is still referenced from table "grades".
```


*14. Create a table*: Create a new table called inspectors with the following properties:

first_name: String of inspector's first name, required
last_name: String of inspector's last name, required
borough: The borough the inspector works in, not required, one of Bronx, Brooklyn, Manhattan, Queens, Staten Island.
inspectors should also have a system generated primary key property, id.

Note that the borough property requires you to use an enumerated type, which is a list of set values you can use for a property. You can use an existing enumerated type that will already be in the table: borough_options.

`
CREATE TYPE borough_type AS ENUM ('Bronx','Brooklyn','Manhattan','Queens','Staten Island');

CREATE TABLE inspectors (
id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
first_name TEXT NOT NULL,
last_name TEXT NOT NULL,
borough borough_type
);
`

*15. Update a table*: Add a notes field to the grades table. notes are not required, and are text.

`ALTER TABLE inspectors ADD COLUMN notes TEXT;`

*16. Drop a table*: Drop the inspectors table from the database.

`DROP TABLE inspectors;`


https://github.com/mjhea0/thinkful-mentor/tree/master/sql/sql-join-practice
https://github.com/scottsimpson/restaurant-database



https://cse442-17f.github.io/Traveling-Salesman-Algorithms/
https://stemlounge.com/animated-algorithms-for-the-traveling-salesman-problem/
https://www.tutorialspoint.com/data_structures_algorithms/avl_tree_algorithm.htm


# Ruby


**VERSÃO 2.0**

Primeiro instalar  o ruby (Versão 2.0.x) e o gems, depois instalar o bundler, que ira fazer a instalação das dependências. 

* `rvm install "ruby-2.0.0-p598"` e `rvm use 2.0.0-p598`
* gem install bundler:1.17.3

**VERSAO 2.2**

* `rvm install "ruby-2.2.10"` e `rvm use 2.2.10`
* gem install bundler:1.17.3

Na pasta do projeto, aonde fica o arquivo Gemfile:

* prosas / app /

Execute o seguinte comando para instalar Gems do Rails: 
* npm run bundleinstall-dev

Se houver problemas para compilar as gems usando o bundleinstall-dev, utilize o Gemlock que está no repo, executando: `cp app/Gemfile.lock.2.0.0p598 app/Gemfile.lock`

Para a pasta the modulos javascript (node_modules), é possível fazer a instalação através do `npm install`, mas parece haver uma customização manual em um dos módulos. Portanto o executar o comando que unzip a copia da pasta node_modules:
* npm run unzip-modules

Caso apresente problemas com a libv8, utilizar:

* bundle config build.libv8 --with-system-v8

Para conhecer os padrões utilizado no ruby, acesse:

* https://github.com/bbatsov/ruby-style-guide



**VERSAO 2.6**

* `rvm install "ruby-2.6.3"` e `rvm use 2.6.3`
* gem install bundler:2.0.0.pre.3
* gem install mysql2 -v '0.3.17'


----


# Banco


Instalar o Mysql Community Server e o Workbench para trabalhar com o banco de dados MYSQL 5.6.

* https://dev.mysql.com/downloads/windows/

No Mac utilizar `brew install mysql@5.6`.

Para acessar o banco de desenvolvimento utilizar:
* DB: prosas_dev
* User: prosas_dev
* Pass: Dev2015

Utilize o workbench para acessar seu Mysql local e crie o esquema:
* prosas_development

Depois no terminal mude a senha de root da seguinte forma:

* `mysql -u root -p` ou `sudo mysql`
* SET PASSWORD FOR 'root'@'localhost' = PASSWORD('root');
* FLUSH PRIVILEGES;

Inicie as tabelas e dados: 
* `rake db:migrare RAILS_ENV=development`;
* `rake db:seed RAILS_ENV=development`;

# MacOS

Algumas particularidades para instalacao do ambiente no MacOS.

Ferramenta para importar chaves na instalação de pacotes:

* https://gpgtools.org/

Garanta que o path com o bin e os header do mysql estejam configurados.  Caso encontre algum problema com bibliotecas relativas ao banco de dados MySQL, verifique as variáveis de ambiente:

* MYSQL=/usr/local/mysql/bin
* export PATH=$PATH:$MYSQL
* export DYLD_LIBRARY_PATH=/usr/local/mysql/lib:$DYLD_LIBRARY_PATH

Instalar as bibliotecas de manipulação de imagem, basicamente a imagemagick v7: 

```sh
brew uninstall imagemagick 
brew install imagemagick jpeg libtiff jasper
brew upgrade imagemagick
```
Pode acontecer de dar erro ao instalar gems do tipo "Cannot load such file — openssl", portanto utilizar:
* rvm pkg install openssl
* rvm install 2.0.0-p598 --with-openssl-dir=$HOME/.rvm/usr
* rvm reinstall all --force

Se for necessário, remova o rvm e instale de novo usando:
* rvm implode
* \curl -sSL https://get.rvm.io | bash


# Ruby

## RVM

Depois instale o RVM, pacote responsavel por manter diversas versoes do ruby funcionando na mesma maquina:

* gpg --keyserver hkp://keys.gnupg.net --recv-keys D39DC0E3

* \curl -sSL https://get.rvm.io | bash -s stable

* source /Users/mariohmol/.rvm/scripts/rvm

## Ruby

* rvm install 2.0

Caso queira utilizar esta versao do ruby, ou definir como padrao:

* rvm use 2.0
* rvm use 2.0 --default

Verifique se a versao instalada esta correta:

* ruby -v
* which ruby

Algumas bibliotecas sao problematicas para instalar, como a debugger, por isso tente instalar isso antes:

* gem install debugger-ruby_core_source

Se não conseguir instalar a gem debugger, principalmente em windows, pode comentar essa as gems debugger e continuar a instalação.

MACOS 

* https://gist.github.com/monicao/d372716cdfbb7e9cf692

# Windows

## Gem Mysql

Erro com lib mysql
Baixar o connector do Mysql em zip:

* http://dev.mysql.com/downloads/connector/c/

No meu caso utilizei uma versao 64 bits:

* ysql-connector-c-6.1.6-winx64

Extrair na pasta:

* D:\ambiente-prosas\mysql-connector


Executar o gem install mysql apontando pra essa pasta

* gem install mysql2 -v 0.3.15 --platform=ruby -- '--with-mysql-dir="D:\ambiente-prosas\mysql-connector"'

Mais informações em:

* http://stackoverflow.com/questions/19014117/ruby-mysql2-gem-installation-on-windows-7


Copie o libmysql.dll dentro da pasta do mysql (ex.: c:\mysql\server\lib ) e cole na pasta bin do seu rails ( ex: c:\ruby2\bin)


## Gems

Versão do bundle foi 1.09 e nao a mais nova.

Se der problema com a versão do nokogiri (gem install nokogiri), utilizar:

* http://www.nokogiri.org/tutorials/installing_nokogiri.html#windows
* http://stackoverflow.com/questions/28999906/require-cannot-load-such-file-nokogiri-nokogiri-loaderror-when-running

Retirar do topo do Gemfile os links para https (apontar pro http)

----

# IDE

Utilizar o Eclipse Aptana e clique em Import -> Folder as a New Project, selecionando a pasta do projeto.

Depois vá em Run Configurations , Ruby Applications, adicione um novo e configure da seguinte forma:

* Main -> Program:  app/bin/rails (do seu projeto)
* Arguments -> Program Arguments : server
*  Arguments -> Working Directory: aponte para a pasta app/
* Source: Adicione o Project prosas
* Environment:
  * RAILSENV: production
  * DYLD_LIBRARY_PATH: /usr/local/mysql/lib:$DYLD_LIBRARY_PATH (adicione a pasta aonde está o lib do  seu mysql)

# Docker

Instalar o docker, o docker-compose e execute:

* docker-compose build
* descompactar o zip do node_modules dentro da pasta app

Para rodar, faça: 
* docker-compose up (Se for background rodar docker-compose up -d)


# Versão do Rails

Documentações sobre processos de migração de Rails e Ruby do prosas.
## Rails 4.1 e Ruby 2.2

Para subir versao do rails:
* Mude o Ruby version: `cp .ruby-version.2.2 .ruby-version`
* Use o novo gemfile: `cp Gemfile.4.1 Gemfile`
* Remove o Gemfile atual: `Gemfile.lock`
* Instale o novo ruby: `rvm install 2.2.10`
* Use o novo ruby `rvm use 2.2.10`
* Instale as libs: `npm run bundleinstall`
* Rode aplicação: `npm run start`

TODO:
arquivos.html `<%= defined?(info_complementaries) && info_complementaries %> || `nao esta funcionando, bug ou versao?


## Rails 4.2

**Paper Trail removido**
* removido na Gem
* removid no has_paper_trail
* removido papertrail initializer
* removido chamadas de PaperTrail::

TODO: Proxima release apagar os comentarios

projeto_controllers TODO
projeto_service


TODO: # enumerize
#gem 'enumerize', '1.1.0'


INSTALAR developer com a rails 4.2
INstalar monitor direto na developer
# Gems
**Turnout**

**Routes**
Retestar mensagens que houve mudanças na rota (uso de action: no lugar de to:)

* empreendedor_nao_encontrado
